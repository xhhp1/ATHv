<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>موقع اللاعب المعتمد ✓ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --primary:#bdaeab;
      --card-bg:#b2a094;
    }

    body, input, select, textarea, button, .label, .tab-btn{
      font-size: 102% !important;
    }

    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:"Tahoma",Arial,sans-serif;
      background: url("https://raw.githubusercontent.com/xhhp1/ATHv/main/1ATH.jpeg") no-repeat center center fixed;
      background-size: cover;
      color:#fff;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:20px;
    }
    .app{
      width:100%;
      max-width:900px;
      background: rgba(60, 60, 60, 0.5);
      backdrop-filter: blur(8px);
      border-radius:16px;
      padding:20px 20px 30px;
      box-shadow:0 0 25px #000;
    }
    h1{
      margin:0 0 16px;
      text-align:center;
      font-size:24px;
    }

    .tabs{
      display:flex;
      flex-wrap:nowrap;
      gap:8px;
      margin-bottom:16px;
      justify-content:center;
      margin-inline:auto;
    }
    .tab-btn{
      direction:ltr;
      flex:0 0 auto;
      min-width:120px;
      border:none;
      border-radius:999px;
      padding:10px 14px;
      font-size:14px;
      background:#111a;
      cursor:pointer;
      color:#fff;
      box-shadow:0 0 10px #000;
      transition:0.2s ease;
      white-space:nowrap;
    }
    .tab-btn.active{
      background:#fff;
      color:#000;
    }

    .tab-content{ display:none; }
    .tab-content.active{
      display:block;
      animation:fadeIn 0.2s ease;
    }
    @keyframes fadeIn{
      from{opacity:0;transform:translateY(4px);}
      to{opacity:1;transform:translateY(0);}
    }

    .section{margin-bottom:16px;}
    .label{
      display:block;
      margin-bottom:4px;
      font-size:14px;
    }

    input[type="number"],
    input[type="text"],
    select,
    textarea{
      width:100%;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #333;
      background:#b2a094;
      color:#fff;
      font-size:14px;
      box-shadow:0 0 10px #000;
    }

    textarea{
      min-height:180px;
      resize:vertical;
      white-space:pre-wrap;
    }

    .primary{
      margin-top:10px;
      border:none;
      border-radius:999px;
      padding:9px 16px;
      font-size:14px;
      background:#fff;
      color:#000;
      cursor:pointer;
      box-shadow:0 0 10px #000;
    }
    .primary:hover{opacity:0.9;}
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .result-box{
      margin-top:10px;
      padding:10px 12px;
      border-radius:10px;
      background:#b2a094;
      box-shadow:0 0 10px #000;
      font-size:14px;
      white-space:pre-wrap;
    }

    .select-wrap{
      display:block;
      position:relative;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .select-wrap:hover{
      transform: translateY(-2px) scale(1.01);
      box-shadow:0 0 14px rgba(0,0,0,0.9);
    }
    .select-wrap:focus-within{
      transform: translateY(-3px) scale(1.03);
      box-shadow:0 0 20px rgba(0,0,0,1);
    }

    #fixedHoursLabel{
      display:none;
      font-weight:bold;
      margin-top:4px;
    }
  </style>

  <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
</head>

<body>
  <div class="app">

    <h1> ✓ Certified  ✓ </h1>

    <div class="tabs">
      <button class="tab-btn active" data-tab="tab1">مدة الانتداب</button>
      <button class="tab-btn" data-tab="tab2">الانتدابات</button>
      <button class="tab-btn" data-tab="tab3">قطع و انتهاء انتداب</button>
      <button class="tab-btn" data-tab="tab4">إجازة خارجية</button>
      <button class="tab-btn" data-tab="tab5">حساب استحقاق الانتداب</button>
    </div>

    <!-- تبويب 1 -->
    <div id="tab1" class="tab-content active">
      <div class="section">
        <span class="label">مدة انتدابك بالأيام (من 2 إلى 5) :</span>
        <input type="number" id="days1" min="2" max="5" />
      </div>

      <div class="section">
        <span class="label">تاريخ ووقت بداية الانتداب :</span>
        <input type="text" id="startDateTime1" placeholder="اختر التاريخ والوقت" />
      </div>

      <button class="primary" id="calcEndBtn">احسب تاريخ نهاية الانتداب</button>

      <div id="endResult" class="result-box"></div>
    </div>

    <!-- تبويب 2: الانتدابات -->
    <div id="tab2" class="tab-content">
      <div class="section" id="days2Section">
        <span class="label" id="days2Label">مدة الانتداب (أيام من 2 إلى 5):</span>
        <input type="number" id="days2" min="2" max="5" />
        <span class="label" id="fixedHoursLabel">** المدة : 3 ساعات **</span>
      </div>

      <div class="section">
        <span class="label">اختر القطاع:</span>
        <div class="select-wrap">
          <select id="sector2">
            <option value="">اختر القطاع</option>
            <option value="الأمن العام">الأمن العام</option>
            <option value="كراج الميكانيكي">كراج الميكانيكي</option>
            <option value="الهلال الاحمر">الهلال الأحمر</option>
            <option value="قوات أمن المنشآت">قوات أمن المنشآت</option>
          </select>
        </div>
      </div>

      <!-- Checkbox انتداب سد عجز -->
      <div class="section">
        <label class="label">
          <input type="checkbox" id="shortage2" style="margin-left:6px;">
          انتداب سد عجز
        </label>
      </div>

      <div class="actions">
        <button class="primary" id="buildTab2">إنشاء النص</button>
        <button class="primary" type="button" onclick="copyFrom('tab2Output')">نسخ</button>
      </div>

      <div class="section">
        <span class="label">الناتج:</span>
        <textarea id="tab2Output" readonly></textarea>
      </div>
    </div>

    <!-- تبويب 3: قطع و انتهاء انتداب -->
    <div id="tab3" class="tab-content">
      <div class="section">
        <span class="label">سبب القطع أو الانتهاء من الانتداب :</span>
        <div class="select-wrap">
          <select id="reason3">
            <option value="">اختر السبب</option>
            <option value="انتهاء انتداب">انتهاء انتداب</option>
            <option value="انهاء بسبب استقالة من قطاع ثانوي">انهاء بسبب استقالة من قطاع ثانوي</option>
            <option value="انتهاء سد عجز">انتهاء سد عجز</option>
            <option value="انهاء انتداب بسبب اجازة خارجية">انهاء انتداب بسبب اجازة خارجية</option>
          </select>
        </div>
      </div>

      <div class="section">
        <span class="label">القطاع المنتدب إليه :</span>
        <div class="select-wrap">
          <select id="sectorFrom3">
            <option value="">القطاع الذي اتممت انتدابك به</option>
            <option value="الأمن العام">الأمن العام</option>
            <option value="كراج الميكانيكي">كراج الميكانيكي</option>
            <option value="الهلال الاحمر">الهلال الأحمر</option>
            <option value="قوات أمن المنشآت">قوات أمن المنشآت</option>
          </select>
        </div>
      </div>

      <div class="section">
        <span class="label">القطاع المطلوب الرجوع له :</span>
        <div class="select-wrap">
          <select id="sectorTo3">
            <option value="">اختر قطاعك الأساسي</option>
            <option value="الأمن العام">الأمن العام</option>
            <option value="كراج الميكانيكي">كراج الميكانيكي</option>
            <option value="الهلال الاحمر">الهلال الأحمر</option>
            <option value="قوات أمن المنشآت">قوات أمن المنشآت</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button class="primary" id="buildTab3">إنشاء النص</button>
        <button class="primary" type="button" onclick="copyFrom('tab3Output')">نسخ</button>
      </div>

      <div class="section">
        <span class="label">الناتج:</span>
        <textarea id="tab3Output" readonly></textarea>
      </div>
    </div>

    <!-- تبويب 4: إجازة خارجية -->
    <div id="tab4" class="tab-content">
      <div class="section">
        <span class="label">الكوبي ايدي :</span>
        <input type="text" id="copyId4" placeholder="الصق الكوبي ايدي هنا مثال : " />
      </div>

      <div class="section">
        <span class="label">الاسم و الكود :</span>
        <input type="text" id="nameCode4" placeholder="مثال : عبدالعزيز الغامدي [CA | A-04]" />
      </div>

      <div class="section">
        <span class="label">مدة الإجازة (أيام):</span>
        <input type="number" id="days4" min="1" />
      </div>

      <div class="section">
        <span class="label">تاريخ بدء الإجازة:</span>
        <input type="text" id="startDate4" placeholder="اختر تاريخ بدء الإجازة" />
      </div>

      <div class="section">
        <span class="label">تاريخ انتهاء الإجازة:</span>
        <input type="text" id="endDate4" placeholder="اختر تاريخ انتهاء الإجازة" />
      </div>

      <div class="section">
        <span class="label">رابط الإجازة من قطاعك:</span>
        <input type="text" id="link4" placeholder="ضع الرابط هنا (اختياري)" />
      </div>

      <div class="actions">
        <button class="primary" id="buildTab4">إنشاء النص</button>
        <button class="primary" type="button" onclick="copyFrom('tab4Output')">نسخ</button>
      </div>

      <div class="section">
        <span class="label">الناتج:</span>
        <textarea id="tab4Output" readonly></textarea>
      </div>
    </div>

    <!-- ✅ تبويب 5: حساب استحقاق الانتداب -->
    <div id="tab5" class="tab-content">
      <div class="section">
        <span class="label">اختر رتبتك في المعتمد:</span>
        <div class="select-wrap">
          <select id="grade5">
            <option value="">اختر رتبة المعتمد</option>
            <option value="CC">CC (8 أيام)</option>
            <option value="CB">CB (6 أيام)</option>
            <option value="CA">CA (4 أيام)</option>
          </select>
        </div>
      </div>

      <div class="section">
        <span class="label">تاريخ نهاية انتداب :</span>
        <input type="text" id="endDateTime5" placeholder="اختر التاريخ والوقت" />
      </div>

      <button class="primary" id="calcEntitlementBtn">احسب تاريخ استحقاق الانتداب</button>

      <div id="entitlementResult5" class="result-box"></div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <script>
    flatpickr("#startDateTime1", {
      enableTime: true,
      dateFormat: "Y-m-d H:i",
      time_24hr: false,
      defaultHour: 12,
      defaultMinute: 0
    });
    flatpickr("#startDate4", { dateFormat: "Y-m-d" });
    flatpickr("#endDate4",   { dateFormat: "Y-m-d" });
    flatpickr("#endDateTime5", {
      enableTime: true,
      dateFormat: "Y-m-d H:i",
      time_24hr: false,
      defaultHour: 12,
      defaultMinute: 0
    });

    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    document.getElementById('calcEndBtn').addEventListener('click',()=>{
      const daysInput  = document.getElementById('days1');
      const startInput = document.getElementById('startDateTime1');
      const resultEl   = document.getElementById('endResult');

      const days = parseInt(daysInput.value,10);
      if (isNaN(days) || days < 2 || days > 5){
        resultEl.textContent = '⚠️ الرجاء إدخال مدة بين 2 و 5 أيام.';
        return;
      }
      if (!startInput.value){
        resultEl.textContent = '⚠️ الرجاء اختيار تاريخ ووقت البداية.';
        return;
      }

      const start = new Date(startInput.value.replace(' ', 'T'));
      if (isNaN(start.getTime())){
        resultEl.textContent = '⚠️ التاريخ المدخل غير صالح.';
        return;
      }

      const end = new Date(start.getTime() + days*24*60*60*1000);

      const formatter = new Intl.DateTimeFormat('en-US', {
        year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit',
        hour12:true,
        timeZone:'Asia/Riyadh'
      });

      resultEl.textContent = 'تاريخ انتهاء الانتداب : ' + formatter.format(end);
    });

    const sectorTemplates = {
      "الأمن العام": `**انتداب إلى:**

<@&1404535941363793982> 
<@&1404535941762388018> 
<@&1404535941669847080> 

**المدة: 0 ايام **`,
      "كراج الميكانيكي": `**انتداب إلى:**

<@&1404535908362879087> 
<@&1404535914948067480> 
<@&1404535906307936357> 
<@&1404535906353811517> 

**المدة: 0 ايام **`,
      "الهلال الاحمر": `**انتداب إلى:**

<@&1404535891443060886> 
<@&1404535891351048413> 
<@&1404535891376214137> 
<@&1404535891401117767> 

**المدة: 0 ايام **`,
      "قوات أمن المنشآت": `**انتداب إلى:**

<@&1404535924469010482> 
<@&1404535924280529059> 
<@&1404535924494438460> 
<@&1404535924372672633>

**المدة: 0 ايام **`
    };

    const sectorRoles = {
      "الأمن العام":
`<@&1404535941363793982> 
<@&1404535941762388018> 
<@&1404535941669847080>`,
      "كراج الميكانيكي":
`<@&1404535908362879087> 
<@&1404535914948067480> 
<@&1404535906307936357> 
<@&1404535906353811517>`,
      "الهلال الاحمر":
`<@&1404535891443060886> 
<@&1404535891351048413> 
<@&1404535891376214137> 
<@&1404535891401117767>`,
      "قوات أمن المنشآت":
`<@&1404535924469010482> 
<@&1404535924280529059> 
<@&1404535924494438460> 
<@&1404535924372672633>`
    };

    const shortageCheckbox = document.getElementById('shortage2');
    const days2Input = document.getElementById('days2');
    const days2Label = document.getElementById('days2Label');
    const fixedHoursLabel = document.getElementById('fixedHoursLabel');

    shortageCheckbox.addEventListener('change', () => {
      if (shortageCheckbox.checked){
        days2Input.style.display = 'none';
        days2Label.style.display = 'none';
        fixedHoursLabel.style.display = 'block';
      } else {
        days2Input.style.display = 'block';
        days2Label.style.display = 'block';
        fixedHoursLabel.style.display = 'none';
      }
    });

    document.getElementById('buildTab2').addEventListener('click',()=>{
      const days = parseInt(document.getElementById('days2').value,10);
      const sector = document.getElementById('sector2').value;
      const out = document.getElementById('tab2Output');
      const isShortage = shortageCheckbox.checked;

      if (!sector){
        out.value = '⚠️ الرجاء اختيار القطاع.';
        return;
      }

      const template = sectorTemplates[sector];
      if (!template){
        out.value = '⚠️ لا يوجد قالب جاهز لهذا القطاع حالياً.';
        return;
      }

      let text = template;

      if (isShortage){
        text = text
          .replace('انتداب إلى:', 'انتداب سد عجز إلى:')
          .replace(/المدة:\s*0\s*ايام/gi, 'المدة : 3 ساعات');
      } else {
        if (isNaN(days) || days < 2 || days > 5){
          out.value = '⚠️ الرجاء إدخال مدة بين 2 و 5 أيام.';
          return;
        }
        text = text.replace(/المدة:\s*0\s*ايام/gi, 'المدة : ' + days + ' ايام');
      }

      out.value = text;
    });

    document.getElementById('buildTab3').addEventListener('click',()=>{
      const reason = document.getElementById('reason3').value;
      const sectorFrom = document.getElementById('sectorFrom3').value;
      const sectorTo   = document.getElementById('sectorTo3').value;
      const out = document.getElementById('tab3Output');

      if (!reason){
        out.value = '⚠️ الرجاء اختيار سبب القطع أو الانتهاء.';
        return;
      }
      if (!sectorFrom || !sectorTo){
        out.value = '⚠️ الرجاء اختيار القطاعين (المنتدب إليه والمطلوب الرجوع له).';
        return;
      }

      const rolesFrom = sectorRoles[sectorFrom];
      const rolesTo   = sectorRoles[sectorTo];

      if (!rolesFrom || !rolesTo){
        out.value = '⚠️ لا توجد رولات محفوظة لأحد القطاعات المختارة. أضفها في كود sectorRoles.';
        return;
      }

      let text = '';

      if (reason === 'انتهاء انتداب'){
        text =
" `انتهاء انتداب من :`\n\n" +
rolesFrom + "\n\n" +
"`العودة الى :`\n\n" +
rolesTo;
      } else if (reason === 'انهاء بسبب استقالة من قطاع ثانوي'){
        text =
" قطع انتداب من :\n\n" +
rolesFrom + "\n\n" +
"العودة الى :\n\n" +
rolesTo + "\n\n" +
"السبب : استقاله من القطاع الثانوي";
      } else if (reason === 'انتهاء سد عجز'){
        text =
" انتهاء انتداب سد العجز من :\n\n" +
rolesFrom + "\n\n\n" +
"العودة  الى :\n" +
rolesTo;
      } else if (reason === 'انهاء انتداب بسبب اجازة خارجية'){
        text =
" قطع انتداب من :\n\n" +
rolesFrom + "\n\n" +
"العودة الى :\n\n" +
rolesTo + "\n\n" +
"السبب : انتهاء انتداب بسبب اجازة خارجية";
      } else {
        text = reason;
      }

      out.value = text;
    });

    document.getElementById('buildTab4').addEventListener('click',()=>{
      const copyId = document.getElementById('copyId4').value.trim();
      const nameCode = document.getElementById('nameCode4').value.trim();
      const days = document.getElementById('days4').value.trim();
      const start = document.getElementById('startDate4').value.trim();
      const end = document.getElementById('endDate4').value.trim();
      const link = document.getElementById('link4').value.trim();
      const out = document.getElementById('tab4Output');

      const duration = days || '0';
      const finalLink = link || 'الرابط هنا';

      out.value =
`منشن لنفسك : <@${copyId}>

الاسم والكود: ${nameCode}

**المدة: ${duration} **

من تاريخ: ${start}

إلى تاريخ: ${end}

**رابط قبول الإجازة من قبل القطاع الأساسي: ${finalLink} **`;
    });

    const gradeDays = { CC: 8, CB: 6, CA: 4 };

    document.getElementById('calcEntitlementBtn').addEventListener('click', () => {
      const grade = document.getElementById('grade5').value;
      const endInput = document.getElementById('endDateTime5');
      const resultEl = document.getElementById('entitlementResult5');

      if (!grade){
        resultEl.textContent = '⚠️ الرجاء اختيار فئة الانتداب.';
        return;
      }
      if (!endInput.value){
        resultEl.textContent = '⚠️ الرجاء اختيار تاريخ نهاية الانتداب.';
        return;
      }

      const baseDate = new Date(endInput.value.replace(' ', 'T'));
      if (isNaN(baseDate.getTime())){
        resultEl.textContent = '⚠️ التاريخ المدخل غير صالح.';
        return;
      }

      const target = new Date(baseDate.getTime() + gradeDays[grade]*24*60*60*1000);

      const formatter = new Intl.DateTimeFormat('en-US', {
        year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit',
        hour12:true,
        timeZone:'Asia/Riyadh'
      });

      resultEl.textContent = 'تاريخ استحقاق الانتداب: ' + formatter.format(target);
    });

    function copyFrom(id){
      const el = document.getElementById(id);
      if (!el) return;
      const text = el.value || el.textContent || '';
      if (navigator.clipboard && window.isSecureContext){
        navigator.clipboard.writeText(text);
      }else{
        const temp = document.createElement('textarea');
        temp.value = text;
        document.body.appendChild(temp);
        temp.select();
        try { document.execCommand('copy'); } catch(e){}
        document.body.removeChild(temp);
      }
    }
    window.copyFrom = copyFrom;
  </script>
</body>
</html>
